/* CENTRAL_IO_H
 * 
 * author: Yuxuan Jiang | CS225 Group10
 * 
 * Description:
 * This file defines the IO haviour of the central heap 
 * 1. for receiving registrations from local registries.
 * 2. for report generating 
 * 
 */
#ifndef CENTRAL_IO_H
#define CENTRAL_IO_H
#include <fstream>
#include <string>
#include <queue>
#include <vector>
#include <fstream>
#include "../fibheap_f.h"
#include "../assqueue/assignment.h"
#include "../../ex1/relation.h"
using namespace std;

registration* Reg_Relation_Delete(int64_t ID);
void Reg_Relation_Insert(registration* Reg);
registration* Reg_Relation_Retrieve(int64_t ID);
vector<registration*>& Reg_Relation_Retrieve_2(int8_t withdraw);
void Per_Relation_Insert(person* Per);
person* Per_Relation_Delete(int64_t ID);
person* Per_Relation_Retrieve(int64_t ID);
void Tre_Relation_Insert(treatment* Tre);
treatment* Tre_Relation_Delete(int64_t ID);
treatment* Tre_Relation_Retrieve(int64_t ID);
vector<treatment*>& Tre_Relation_Retrieve_2(int64_t week);

// TODO: ADD this class as a friend class of FibHeap
class CentralIO{
    public:
        CentralIO(FibHeap* n_vacc_heap, FibHeap* n_surg_heap, FibHeap* n_regi_heap, string n_path, Assignment* n_assignment)
                    : vacc_heap(n_vacc_heap)
                    , surg_heap(n_surg_heap)
                    , regi_heap(n_regi_heap)
                    , path(n_path)
                    , assignment(n_assignment) {};
        bool Read2Heap();   // This function reads registration information from files generated by local registries, the return value implies whether the operation succeeds
        bool ReportWeekly(int week,int key);
        bool ReportMonthly(int month, int key);
        bool compare(registration* a, registration* b, int key);
        void sortByKey(vector<registration*>& Reg_list,int key);       //TODO sortbykey
        bool Write2File(vector<registration*>&print_list, int date, int type);
        int IO_timer = 1;   // this timer is in sync with the one in Central_Main


    private:
        // ======= Modification =======
        FibHeap* vacc_heap;   // heap for vaccination
        FibHeap* surg_heap;   // heap for surgery
        FibHeap* regi_heap;   // heap for regular registration
        // ======= Modification =======
        string path;
        Assignment* assignment;
        // vector<vector> register_arr;
        bool _WeeklyCured(int week, int key);
        bool _WeeklyAssigned(int week, int key);
        bool _WeeklyQueueing(int week, int key);
        bool _Monthly(int month, int key);
};

// Packing all info needed to be printed into a single class 
class PrintInfo {
    public:


    private:
        int64_t         reg_id;
        int64_t         per_id;
        int64_t         tre_id;
        int8_t          treatment_type;
        string          name;
        string          risk_status;
        string          date_of_reg;
        int64_t         wait_time;


}

#endif